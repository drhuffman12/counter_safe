{"repository_name":"counter_safe","body":"# counter_safe\n\nThread safe counters:\n* [CounterSafe::Shared](src/counter_safe/shared.cr)       -- e.g.: global shared counters\n* [CounterSafe::Exclusive](src/counter_safe/exclusive.cr) -- e.g.: class-local exclusive counters\n\nBased on and with much thanks to: https://itnext.io/comparing-crystals-concurrency-with-that-of-go-part-ii-89049701b1a5\n\n## Installation\n\n1. Add the dependency to your `shard.yml`:\n\n   ```yaml\n   dependencies:\n     counter_safe:\n       github: drhuffman12/counter_safe\n   ```\n\n2. Run `shards install`\n  ... or `shards install --ignore-crystal-version`\n\n## Usage\n\n```crystal\nrequire \"counter_safe\"\n```\n\nExample Usage:\n* Shared counters\n  ```\n  cs1 = CounterSafe::Shared.new\n  cs2 = CounterSafe::Shared.new\n  (1..1000).each {\n    rand < 0.25 ? spawn cs1.inc(\"someKey\") : spawn cs2.inc(\"someKey\")\n  }\n\n  sleep 1.second\n  puts cs1.value(\"someKey\")\n  puts cs2.value(\"someKey\") #=> Should be the same as 'cs1.value(\"someKey\")'\n  ```\n\n* Exclusive counters\n  ```\n  ce1 = CounterSafe::Exclusive.new\n  ce2 = CounterSafe::Exclusive.new\n  (1..1000).each {\n    rand < 0.25 ? spawn ce1.inc(\"someKey\") : spawn ce2.inc(\"someKey\")\n  }\n  puts ce1.value(\"someKey\")\n  puts ce2.value(\"someKey\") #=> Should be DIFFERENT than as 'cs1.value(\"someKey\")'\n  ```\n\nSee also API doc's at: https://drhuffman12.github.io/counter_safe\n\n## Contributing\n\n1. Fork it (<https://github.com/your-github-user/counter_safe/fork>)\n2. Create your feature branch (`git checkout -b my-new-feature`)\n3. Commit your changes (`git commit -am 'Add some feature'`)\n4. Push to the branch (`git push origin my-new-feature`)\n5. Create a new Pull Request\n\n## Contributors\n\n- [Daniel Huffman](https://github.com/drhuffman12) - creator and maintainer\n","program":{"html_id":"counter_safe/toplevel","path":"toplevel.html","kind":"module","full_name":"Top Level Namespace","name":"Top Level Namespace","abstract":false,"superclass":null,"ancestors":[],"locations":[],"repository_name":"counter_safe","program":true,"enum":false,"alias":false,"aliased":null,"aliased_html":null,"const":false,"constants":[],"included_modules":[],"extended_modules":[],"subclasses":[],"including_types":[],"namespace":null,"doc":null,"summary":null,"class_methods":[],"constructors":[],"instance_methods":[],"macros":[],"types":[{"html_id":"counter_safe/CounterSafe","path":"CounterSafe.html","kind":"module","full_name":"CounterSafe","name":"CounterSafe","abstract":false,"superclass":null,"ancestors":[],"locations":[],"repository_name":"counter_safe","program":false,"enum":false,"alias":false,"aliased":null,"aliased_html":null,"const":false,"constants":[{"id":"VERSION","name":"VERSION","value":"{{ (`shards version \\\"/home/drhuffman/_tmp_/github/drhuffman12/counter_safe/src\\\"`).chomp.stringify }}","doc":null,"summary":null}],"included_modules":[],"extended_modules":[],"subclasses":[],"including_types":[],"namespace":null,"doc":"TODO: Write documentation for `CounterSafe`","summary":"<p><span class=\"flag orange\">TODO</span>  Write documentation for <code><a href=\"CounterSafe.html\">CounterSafe</a></code></p>","class_methods":[],"constructors":[],"instance_methods":[],"macros":[],"types":[{"html_id":"counter_safe/CounterSafe/AbstractCounter","path":"CounterSafe/AbstractCounter.html","kind":"class","full_name":"CounterSafe::AbstractCounter","name":"AbstractCounter","abstract":true,"superclass":{"html_id":"counter_safe/Reference","kind":"class","full_name":"Reference","name":"Reference"},"ancestors":[{"html_id":"counter_safe/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"counter_safe/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[],"repository_name":"counter_safe","program":false,"enum":false,"alias":false,"aliased":null,"aliased_html":null,"const":false,"constants":[],"included_modules":[],"extended_modules":[],"subclasses":[{"html_id":"counter_safe/CounterSafe/Exclusive","kind":"class","full_name":"CounterSafe::Exclusive","name":"Exclusive"},{"html_id":"counter_safe/CounterSafe/Shared","kind":"class","full_name":"CounterSafe::Shared","name":"Shared"}],"including_types":[],"namespace":{"html_id":"counter_safe/CounterSafe","kind":"module","full_name":"CounterSafe","name":"CounterSafe"},"doc":null,"summary":null,"class_methods":[{"id":"from_json(jsonified_values:String)-class-method","html_id":"from_json(jsonified_values:String)-class-method","name":"from_json","doc":null,"summary":null,"abstract":false,"args":[{"name":"jsonified_values","doc":null,"default_value":"","external_name":"jsonified_values","restriction":"String"}],"args_string":"(jsonified_values : String)","args_html":"(jsonified_values : String)","location":{"filename":"src/counter_safe/abstract_counter.cr","line_number":77,"url":null},"def":{"name":"from_json","args":[{"name":"jsonified_values","doc":null,"default_value":"","external_name":"jsonified_values","restriction":"String"}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"inst = self.new\ninst.reset_all(jsonified_values)\ninst\n"}}],"constructors":[{"id":"new-class-method","html_id":"new-class-method","name":"new","doc":null,"summary":null,"abstract":false,"args":[],"args_string":"","args_html":"","location":{"filename":"src/counter_safe/abstract_counter.cr","line_number":5,"url":null},"def":{"name":"new","args":[],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"_ = allocate\n_.initialize\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"}}],"instance_methods":[{"id":"inc(key:String)-instance-method","html_id":"inc(key:String)-instance-method","name":"inc","doc":null,"summary":null,"abstract":false,"args":[{"name":"key","doc":null,"default_value":"","external_name":"key","restriction":"String"}],"args_string":"(key : String)","args_html":"(key : String)","location":{"filename":"src/counter_safe/abstract_counter.cr","line_number":19,"url":null},"def":{"name":"inc","args":[{"name":"key","doc":null,"default_value":"","external_name":"key","restriction":"String"}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"begin\n  @mux.lock\n  the_value = get_counter!.has_key?(key) ? (get_counter!(key)) + 1 : 1\n  set_counter!(key, the_value)\nensure\n  @mux.unlock\n  the_value\nend"}},{"id":"reset(key:String,the_value:Int32=0)-instance-method","html_id":"reset(key:String,the_value:Int32=0)-instance-method","name":"reset","doc":null,"summary":null,"abstract":false,"args":[{"name":"key","doc":null,"default_value":"","external_name":"key","restriction":"String"},{"name":"the_value","doc":null,"default_value":"0","external_name":"the_value","restriction":"Int32"}],"args_string":"(key : String, the_value : Int32 = <span class=\"n\">0</span>)","args_html":"(key : String, the_value : Int32 = <span class=\"n\">0</span>)","location":{"filename":"src/counter_safe/abstract_counter.cr","line_number":39,"url":null},"def":{"name":"reset","args":[{"name":"key","doc":null,"default_value":"","external_name":"key","restriction":"String"},{"name":"the_value","doc":null,"default_value":"0","external_name":"the_value","restriction":"Int32"}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"begin\n  @mux.lock\n  set_counter!(key, the_value)\nensure\n  @mux.unlock\n  the_value\nend"}},{"id":"reset!-instance-method","html_id":"reset!-instance-method","name":"reset!","doc":null,"summary":null,"abstract":false,"args":[],"args_string":"","args_html":"","location":{"filename":"src/counter_safe/abstract_counter.cr","line_number":29,"url":null},"def":{"name":"reset!","args":[],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"begin\n  @mux.lock\n  init_counter!\nensure\n  @mux.unlock\n  get_counter!\nend"}},{"id":"reset_all(jsonified_values:String)-instance-method","html_id":"reset_all(jsonified_values:String)-instance-method","name":"reset_all","doc":null,"summary":null,"abstract":false,"args":[{"name":"jsonified_values","doc":null,"default_value":"","external_name":"jsonified_values","restriction":"String"}],"args_string":"(jsonified_values : String)","args_html":"(jsonified_values : String)","location":{"filename":"src/counter_safe/abstract_counter.cr","line_number":83,"url":null},"def":{"name":"reset_all","args":[{"name":"jsonified_values","doc":null,"default_value":"","external_name":"jsonified_values","restriction":"String"}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"begin\n  @mux.lock\n  parsed = InternalCounterClass.from_json(jsonified_values)\n  set_counter!(parsed)\nensure\n  @mux.unlock\n  get_counter!\nend"}},{"id":"to_json(builder:JSON::Builder)-instance-method","html_id":"to_json(builder:JSON::Builder)-instance-method","name":"to_json","doc":null,"summary":null,"abstract":false,"args":[{"name":"builder","doc":null,"default_value":"","external_name":"builder","restriction":"JSON::Builder"}],"args_string":"(builder : JSON::Builder)","args_html":"(builder : JSON::Builder)","location":{"filename":"src/counter_safe/abstract_counter.cr","line_number":59,"url":null},"def":{"name":"to_json","args":[{"name":"builder","doc":null,"default_value":"","external_name":"builder","restriction":"JSON::Builder"}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"builder.object do\n  get_counter!.each do |k, v|\n    builder.field(k, v)\n  end\nend\nbuilder\n"}},{"id":"to_json-instance-method","html_id":"to_json-instance-method","name":"to_json","doc":null,"summary":null,"abstract":false,"args":[],"args_string":"","args_html":"","location":{"filename":"src/counter_safe/abstract_counter.cr","line_number":54,"url":null},"def":{"name":"to_json","args":[],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"values.to_json"}},{"id":"value(key:String)-instance-method","html_id":"value(key:String)-instance-method","name":"value","doc":null,"summary":null,"abstract":false,"args":[{"name":"key","doc":null,"default_value":"","external_name":"key","restriction":"String"}],"args_string":"(key : String)","args_html":"(key : String)","location":{"filename":"src/counter_safe/abstract_counter.cr","line_number":11,"url":null},"def":{"name":"value","args":[{"name":"key","doc":null,"default_value":"","external_name":"key","restriction":"String"}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"begin\n  @mux.lock\n  get_counter!(key)\nensure\n  @mux.unlock\nend"}},{"id":"values-instance-method","html_id":"values-instance-method","name":"values","doc":null,"summary":null,"abstract":false,"args":[],"args_string":"","args_html":"","location":{"filename":"src/counter_safe/abstract_counter.cr","line_number":69,"url":null},"def":{"name":"values","args":[],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"begin\n  @mux.lock\n  get_counter!\nensure\n  @mux.unlock\nend"}}],"macros":[],"types":[{"html_id":"counter_safe/CounterSafe/AbstractCounter/InternalCounterClass","path":"CounterSafe/AbstractCounter/InternalCounterClass.html","kind":"alias","full_name":"CounterSafe::AbstractCounter::InternalCounterClass","name":"InternalCounterClass","abstract":false,"superclass":null,"ancestors":[],"locations":[],"repository_name":"counter_safe","program":false,"enum":false,"alias":true,"aliased":"Hash(String, Int32)","aliased_html":"Hash(String, Int32)","const":false,"constants":[],"included_modules":[],"extended_modules":[],"subclasses":[],"including_types":[],"namespace":{"html_id":"counter_safe/CounterSafe/AbstractCounter","kind":"class","full_name":"CounterSafe::AbstractCounter","name":"AbstractCounter"},"doc":null,"summary":null,"class_methods":[],"constructors":[],"instance_methods":[],"macros":[],"types":[]}]},{"html_id":"counter_safe/CounterSafe/Exclusive","path":"CounterSafe/Exclusive.html","kind":"class","full_name":"CounterSafe::Exclusive","name":"Exclusive","abstract":false,"superclass":{"html_id":"counter_safe/CounterSafe/AbstractCounter","kind":"class","full_name":"CounterSafe::AbstractCounter","name":"AbstractCounter"},"ancestors":[{"html_id":"counter_safe/CounterSafe/AbstractCounter","kind":"class","full_name":"CounterSafe::AbstractCounter","name":"AbstractCounter"},{"html_id":"counter_safe/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"counter_safe/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[],"repository_name":"counter_safe","program":false,"enum":false,"alias":false,"aliased":null,"aliased_html":null,"const":false,"constants":[],"included_modules":[],"extended_modules":[],"subclasses":[],"including_types":[],"namespace":{"html_id":"counter_safe/CounterSafe","kind":"module","full_name":"CounterSafe","name":"CounterSafe"},"doc":null,"summary":null,"class_methods":[],"constructors":[],"instance_methods":[],"macros":[],"types":[]},{"html_id":"counter_safe/CounterSafe/Shared","path":"CounterSafe/Shared.html","kind":"class","full_name":"CounterSafe::Shared","name":"Shared","abstract":false,"superclass":{"html_id":"counter_safe/CounterSafe/AbstractCounter","kind":"class","full_name":"CounterSafe::AbstractCounter","name":"AbstractCounter"},"ancestors":[{"html_id":"counter_safe/CounterSafe/AbstractCounter","kind":"class","full_name":"CounterSafe::AbstractCounter","name":"AbstractCounter"},{"html_id":"counter_safe/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"counter_safe/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[],"repository_name":"counter_safe","program":false,"enum":false,"alias":false,"aliased":null,"aliased_html":null,"const":false,"constants":[],"included_modules":[],"extended_modules":[],"subclasses":[],"including_types":[],"namespace":{"html_id":"counter_safe/CounterSafe","kind":"module","full_name":"CounterSafe","name":"CounterSafe"},"doc":null,"summary":null,"class_methods":[],"constructors":[],"instance_methods":[],"macros":[],"types":[]}]}]}}